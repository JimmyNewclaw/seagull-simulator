<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Manatee Simulator</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;600&display=swap');
*{margin:0;padding:0;box-sizing:border-box}
body{overflow:hidden;background:#071a2a;font-family:'Quicksand',sans-serif;user-select:none}
canvas{display:block}
#title-screen{position:fixed;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:100;background:linear-gradient(180deg,#071a2a,#0d3d5c 30%,#1a6b7a 60%,#2a9d8f 80%,#40c9a2);transition:opacity 2s;cursor:pointer}
#title-screen.hidden{opacity:0;pointer-events:none}
#title-screen h1{font-size:clamp(2.5rem,8vw,5.5rem);font-weight:300;color:#e0f7fa;letter-spacing:.15em;text-transform:uppercase;text-shadow:0 0 60px rgba(64,201,162,.4);animation:bob 4s ease-in-out infinite}
#title-screen p{font-size:clamp(.85rem,2.5vw,1.2rem);color:rgba(224,247,250,.5);font-weight:300;letter-spacing:.3em;margin:.3em 0 1.5em}
#title-screen .sub{font-size:clamp(.65rem,1.4vw,.8rem);color:rgba(224,247,250,.22);letter-spacing:.1em;max-width:520px;text-align:center;line-height:2.2;margin-bottom:2.5em}
#title-screen .start{font-size:clamp(.8rem,2vw,1rem);color:rgba(224,247,250,.3);letter-spacing:.2em;animation:pulse 2.5s ease-in-out infinite}
@keyframes bob{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
@keyframes pulse{0%,100%{opacity:.3}50%{opacity:.65}}
#hud{position:fixed;inset:0;pointer-events:none;z-index:10}
#mood{position:fixed;bottom:40px;left:50%;transform:translateX(-50%);color:rgba(224,247,250,.28);font-size:clamp(.75rem,1.8vw,1rem);font-weight:300;letter-spacing:.25em;text-align:center;opacity:0;transition:opacity 1.5s}
#mood.on{opacity:1}
#disc{position:fixed;top:45%;left:50%;transform:translate(-50%,-50%);color:#ffd700;font-size:clamp(1rem,3vw,1.4rem);font-weight:600;letter-spacing:.1em;text-align:center;opacity:0;transition:opacity .5s;text-shadow:0 0 20px rgba(255,215,0,.5);max-width:85vw}
#disc.on{opacity:1}
#dep{position:fixed;top:20px;right:20px;color:rgba(224,247,250,.18);font-size:.65rem;letter-spacing:.12em}
#fnd{position:fixed;top:38px;right:20px;color:rgba(224,247,250,.13);font-size:.55rem;letter-spacing:.1em}
#dctl{position:fixed;bottom:18px;left:18px;color:rgba(224,247,250,.15);font-size:.55rem;letter-spacing:.08em;line-height:2}
@media(pointer:coarse){#dctl{display:none}}
#mui{display:none;position:fixed;bottom:0;left:0;right:0;height:200px;z-index:50;pointer-events:none}
@media(pointer:coarse){#mui{display:block}}
#jz{position:absolute;bottom:20px;left:20px;width:130px;height:130px;pointer-events:all;touch-action:none}
#jb{width:130px;height:130px;border-radius:50%;background:rgba(224,247,250,.06);border:1.5px solid rgba(224,247,250,.1);position:relative}
#jt{width:44px;height:44px;border-radius:50%;background:rgba(224,247,250,.16);position:absolute;top:43px;left:43px}
.mbtn{position:absolute;pointer-events:all;touch-action:none;width:54px;height:54px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.55rem;color:rgba(224,247,250,.35);border:1.5px solid rgba(224,247,250,.08);background:rgba(224,247,250,.03)}
#bu{bottom:88px;right:20px}
#bd{bottom:20px;right:20px}
</style>
<script defer src="/_vercel/insights/script.js"></script>
</head>
<body>
<div id="title-screen">
<h1>Manatee Simulator</h1>
<p>no goals ¬∑ no pressure ¬∑ just float</p>
<div class="sub">explore the ocean ¬∑ find hidden creatures ¬∑ discover 14 easter eggs<br>üñ•Ô∏è WASD move ¬∑ Mouse look ¬∑ Space up ¬∑ Shift down ¬∑ Scroll zoom<br>üì± Left joystick move ¬∑ Swipe right side to look ¬∑ ‚ñ≤‚ñº buttons up/down</div>
<div class="start">tap anywhere to begin</div>
</div>
<div id="hud"><div id="mood"></div><div id="disc"></div><div id="dep"></div><div id="fnd"></div></div>
<div id="dctl">WASD ‚Äî swim<br>Mouse ‚Äî look around<br>Space ‚Äî up ¬∑ Shift ‚Äî down<br>Scroll ‚Äî zoom in/out</div>
<div id="mui">
<div id="jz"><div id="jb"><div id="jt"></div></div></div>
<div class="mbtn" id="bu">‚ñ≤ UP</div>
<div class="mbtn" id="bd">‚ñº DN</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
"use strict";
let go=false,S,C,R,CK;
let M,K={},cH=Math.PI,cV=.1,cD=10,lk=false;
let ja=false,jdx=0,jdz=0,tlid=null,tlx=0,tly=0,mu=false,md=false;
const WS=200;
const GR=[],FI=[],JE=[],CR=[],SG=[],BB=[];
let fc=0;const disc=new Set();
const moods=['just floating...','the water is warm here','no thoughts, only manatee','a gentle current passes by','the seagrass sways softly','everything is okay','breathe in... breathe out...','sunlight dances above','you are enough','time moves slowly here','the ocean holds you','peace','you drift with the tide','nothing to do. nowhere to be.','the world can wait','slow down. you\'re already here.','somewhere a whale sings','the reef hums with life'];
const eggs=[
{t:'ü¶ê SHRIMP CROSSING ‚Äî yield to tiny legs',p:[30,0,40]},
{t:'üê° PUFFERFISH ZONE ‚Äî no sudden moves',p:[-50,3,-30]},
{t:'ü¶Ä CRAB RAVE AREA ‚Äî Fridays only',p:[70,-1,60]},
{t:'‚ö†Ô∏è SHARK THINKS HE\'S SCARY ‚Äî he\'s not',p:[-20,6,-70]},
{t:'üê¢ TURTLE SPEED LIMIT: CHILL',p:[40,1,-50]},
{t:'üßΩ SPONGEBOB DOES NOT LIVE HERE',p:[-60,0,20]},
{t:'ü´ß BUBBLE FACTORY ‚Äî est. forever ago',p:[10,10,80]},
{t:'üêã WHALE WATCHING ‚Äî look up sometimes',p:[0,12,0]},
{t:'ü¶û LOBSTER LARRY\'S ‚Äî best claws in town',p:[80,-1,-40]},
{t:'üåä YOU\'VE SWAM 0 MINUTES ‚Äî relax',p:[-80,4,50]},
{t:'üê† FINDING NEMO SPOILER: he was found',p:[50,5,-80]},
{t:'üßä WATER IS WET ‚Äî citation needed',p:[-40,2,70]}];

function init(){
S=new THREE.Scene();S.fog=new THREE.FogExp2(0x0a3040,.007);S.background=new THREE.Color(0x0a3040);
C=new THREE.PerspectiveCamera(65,innerWidth/innerHeight,.1,600);
R=new THREE.WebGLRenderer({antialias:true});R.setSize(innerWidth,innerHeight);R.setPixelRatio(Math.min(devicePixelRatio,2));
document.body.appendChild(R.domElement);CK=new THREE.Clock();
S.add(new THREE.AmbientLight(0x3a6a7a,.7));
const sun=new THREE.DirectionalLight(0x99ddbb,.9);sun.position.set(40,80,20);S.add(sun);
S.add(new THREE.HemisphereLight(0x88ccaa,0x224433,.4));
const pt=new THREE.PointLight(0x66ddbb,.5,80);pt.position.set(0,30,0);S.add(pt);
mkManatee();mkFloor();mkGrass();mkKelp();mkCoral();mkFish();mkJelly();mkWhale();mkShark();mkSmall();mkTurtle();mkShafts();mkWater();mkParticles();mkSigns();
M.position.set(0,8,0);
M.visible=true;
input();showMood();
}

function mkManatee(){
M=new THREE.Group();
const bm=new THREE.MeshPhongMaterial({color:0x7a9a78,shininess:15});
const dm=new THREE.MeshPhongMaterial({color:0x5a7a58,shininess:5});
let g=new THREE.SphereGeometry(1,16,12);g.scale(2.4,1.05,1.15);M.add(new THREE.Mesh(g,bm));
g=new THREE.SphereGeometry(1,12,8);g.scale(1.7,.72,.95);const bl=new THREE.Mesh(g,new THREE.MeshPhongMaterial({color:0x95ab90}));bl.position.set(.2,-.28,0);M.add(bl);
g=new THREE.SphereGeometry(.88,12,10);g.scale(1,.92,.98);const hd=new THREE.Mesh(g,bm);hd.position.set(2.2,.12,0);M.add(hd);
g=new THREE.SphereGeometry(.58,10,8);g.scale(.82,.88,1);const sn=new THREE.Mesh(g,new THREE.MeshPhongMaterial({color:0x8aaa86,shininess:20}));sn.position.set(2.9,-.04,0);M.add(sn);
[-1,1].forEach(s=>{const ew=new THREE.Mesh(new THREE.SphereGeometry(.13,8,8),new THREE.MeshPhongMaterial({color:0xddeedd,shininess:50}));ew.position.set(2.4,.28,s*.68);M.add(ew);const ep=new THREE.Mesh(new THREE.SphereGeometry(.085,8,8),new THREE.MeshPhongMaterial({color:0x1a2a1a,shininess:80}));ep.position.set(2.47,.29,s*.72);M.add(ep)});
[-1,1].forEach(s=>{const n=new THREE.Mesh(new THREE.SphereGeometry(.06,6,6),new THREE.MeshPhongMaterial({color:0x4a6a48}));n.position.set(3.25,.16,s*.19);M.add(n)});
g=new THREE.SphereGeometry(1,10,6);g.scale(1.3,.16,.95);const tl=new THREE.Mesh(g,dm);tl.position.set(-3.1,0,0);tl.name='tail';M.add(tl);
g=new THREE.SphereGeometry(.5,8,6);g.scale(1.6,.62,.62);const tc=new THREE.Mesh(g,bm);tc.position.set(-2.3,0,0);tc.name='tc';M.add(tc);
[-1,1].forEach(s=>{g=new THREE.SphereGeometry(.42,8,6);g.scale(1.3,.2,.72);const f=new THREE.Mesh(g,dm);f.position.set(.9,-.65,s*1.15);f.rotation.x=s*.3;f.rotation.z=s*.4;f.name=s>0?'fr':'fl';M.add(f)});
M.scale.set(.65,.65,.65);S.add(M);
}

function mkFloor(){
let g=new THREE.PlaneGeometry(WS*1.5,WS*1.5,100,100);g.rotateX(-Math.PI/2);
const p=g.attributes.position;
for(let i=0;i<p.count;i++){const x=p.getX(i),z=p.getZ(i);p.setY(i,-2+Math.sin(x*.04)*2+Math.cos(z*.05)*1.8+Math.sin(x*.015+z*.02)*4+(Math.random()-.5)*.5)}
g.computeVertexNormals();
S.add(new THREE.Mesh(g,new THREE.MeshPhongMaterial({color:0x2a4a2a,shininess:5,flatShading:true})).translateY(-6));
for(let i=0;i<40;i++){g=new THREE.CircleGeometry(2+Math.random()*8,8);g.rotateX(-Math.PI/2);const m=new THREE.Mesh(g,new THREE.MeshPhongMaterial({color:0x5a7a55,flatShading:true,transparent:true,opacity:.4}));m.position.set((Math.random()-.5)*WS,-5.5,(Math.random()-.5)*WS);S.add(m)}
for(let i=0;i<60;i++){g=new THREE.DodecahedronGeometry(.4+Math.random()*2.5,1);g.scale(1,.4+Math.random()*.4,1);const r=new THREE.Mesh(g,new THREE.MeshPhongMaterial({color:new THREE.Color().setHSL(.28,.12,.22+Math.random()*.1),flatShading:true}));r.position.set((Math.random()-.5)*WS*1.2,-5.8,(Math.random()-.5)*WS*1.2);r.rotation.y=Math.random()*6.28;S.add(r)}
}

function mkGrass(){
for(let i=0;i<400;i++){const h=1.5+Math.random()*5;const g=new THREE.PlaneGeometry(.12+Math.random()*.08,h,1,5);const p=g.attributes.position;for(let j=0;j<p.count;j++){const t=(p.getY(j)+h/2)/h;p.setX(j,p.getX(j)+Math.sin(t*1.8)*.4*t)}
const m=new THREE.Mesh(g,new THREE.MeshPhongMaterial({color:new THREE.Color().setHSL(.28+Math.random()*.1,.5+Math.random()*.3,.2+Math.random()*.15),side:2,flatShading:true,transparent:true,opacity:.75}));
m.position.set((Math.random()-.5)*WS*1.2,-4+h/2,(Math.random()-.5)*WS*1.2);m.rotation.y=Math.random()*6.28;S.add(m);
GR.push({m:m,bz:m.rotation.z,ph:Math.random()*6.28,sp:.4+Math.random()*.8})}
}

function mkKelp(){
for(let f=0;f<6;f++){const cx=(Math.random()-.5)*WS*.8,cz=(Math.random()-.5)*WS*.8;
for(let k=0;k<8+Math.floor(Math.random()*10);k++){const h=8+Math.random()*15,n=8,kg=new THREE.Group();
for(let i=0;i<n;i++){const sg=new THREE.CylinderGeometry(.06,.08,.9+Math.random()*.3,5);const seg=new THREE.Mesh(sg,new THREE.MeshPhongMaterial({color:new THREE.Color().setHSL(.22+Math.random()*.05,.6,.2+Math.random()*.1),flatShading:true}));seg.position.y=i*h/n;seg.name='ks';kg.add(seg);
if(i>2&&Math.random()>.4){const lf=new THREE.Mesh(new THREE.PlaneGeometry(.8+Math.random()*.4,.3),new THREE.MeshPhongMaterial({color:0x3a7a2a,side:2,transparent:true,opacity:.6}));lf.position.set(.15,i*h/n,0);lf.rotation.set(0,Math.random()*6.28,(Math.random()-.5)*.5);kg.add(lf)}}
kg.position.set(cx+(Math.random()-.5)*8,-5,cz+(Math.random()-.5)*8);S.add(kg);
GR.push({m:kg,bz:0,ph:Math.random()*6.28,sp:.3+Math.random()*.3,kp:true})}}}

function mkCoral(){
const cc=[0xcc5566,0xdd8844,0xcc66aa,0x66aacc,0xddaa44,0xaa55cc,0xff7788,0x55ccaa];
for(let i=0;i<80;i++){const c=cc[i%cc.length],ty=Math.floor(Math.random()*4);let m;
if(ty===0){const g=new THREE.DodecahedronGeometry(.7+Math.random()*1.5,2);g.scale(1,.55,1);m=new THREE.Mesh(g,new THREE.MeshPhongMaterial({color:c,flatShading:true}))}
else if(ty===1){m=new THREE.Group();for(let b=0;b<3+Math.floor(Math.random()*5);b++){const bg=new THREE.CylinderGeometry(.05,.1,.8+Math.random()*2,5);const br=new THREE.Mesh(bg,new THREE.MeshPhongMaterial({color:c,flatShading:true}));br.position.y=br.geometry.parameters.height/2;br.rotation.set((Math.random()-.5)*.7,0,(Math.random()-.5)*.7);const tp=new THREE.Mesh(new THREE.SphereGeometry(.1,6,6),new THREE.MeshPhongMaterial({color:new THREE.Color(c).multiplyScalar(1.4),flatShading:true}));tp.position.y=br.geometry.parameters.height;br.add(tp);m.add(br)}}
else if(ty===2){const g=new THREE.TorusGeometry(.5+Math.random()*.5,.12,6,12,Math.PI*.8);m=new THREE.Mesh(g,new THREE.MeshPhongMaterial({color:c,flatShading:true,transparent:true,opacity:.65,side:2}));m.rotation.x=-1.3+(Math.random()-.5)*.4}
else{m=new THREE.Group();m.add(new THREE.Mesh(new THREE.CylinderGeometry(.3,.4,.5,8),new THREE.MeshPhongMaterial({color:0x885566,flatShading:true})));for(let t=0;t<12;t++){const tn=new THREE.Mesh(new THREE.CylinderGeometry(.03,.02,.6+Math.random()*.4,4),new THREE.MeshPhongMaterial({color:c,flatShading:true,transparent:true,opacity:.6}));const a=(t/12)*6.28;tn.position.set(Math.cos(a)*.2,.5,Math.sin(a)*.2);tn.rotation.set((Math.random()-.5)*.5,0,(Math.random()-.5)*.5);tn.name='at';m.add(tn)}}
m.position.set((Math.random()-.5)*WS*1.1,-5+Math.random()*.8,(Math.random()-.5)*WS*1.1);m.rotation.y=Math.random()*6.28;S.add(m)}}

function mkFish(){
const fc=[0xffaa44,0x44aaff,0xff6677,0x44ddaa,0xffdd44,0xaa66ff,0xff8855,0x55aaff,0xffcc66,0x66ffaa];
for(let s=0;s<14;s++){const ct=new THREE.Vector3((Math.random()-.5)*WS*.8,2+Math.random()*20,(Math.random()-.5)*WS*.8),cl=fc[s%fc.length],sc=[];
for(let f=0;f<8+Math.floor(Math.random()*14);f++){const fg=new THREE.Group(),sz=.15+Math.random()*.25;
let g=new THREE.SphereGeometry(sz,6,5);g.scale(2,.8,1);fg.add(new THREE.Mesh(g,new THREE.MeshPhongMaterial({color:cl,flatShading:true,shininess:30})));
g=new THREE.ConeGeometry(sz*.6,sz*1.2,4);g.rotateZ(Math.PI/2);const tl=new THREE.Mesh(g,new THREE.MeshPhongMaterial({color:new THREE.Color(cl).multiplyScalar(.8),flatShading:true}));tl.position.x=-sz*1.8;tl.name='ft';fg.add(tl);
[1,-1].forEach(side=>{const e=new THREE.Mesh(new THREE.SphereGeometry(sz*.14,4,4),new THREE.MeshPhongMaterial({color:0x111111}));e.position.set(sz*1.1,sz*.12,side*sz*.45);fg.add(e)});
fg.position.copy(ct).add(new THREE.Vector3((Math.random()-.5)*6,(Math.random()-.5)*3,(Math.random()-.5)*6));fg.scale.setScalar(.7+Math.random()*.5);S.add(fg);
sc.push({m:fg,v:new THREE.Vector3((Math.random()-.5)*.4,0,(Math.random()-.5)*.4),ct:ct.clone(),ph:Math.random()*6.28})}FI.push(sc)}}

function mkJelly(){
const jc=[0xaa66dd,0xdd66aa,0x66aadd,0xddaa66,0x66ddaa,0xdd88cc,0x88aadd];
for(let i=0;i<22;i++){const sz=.35+Math.random()*1.25,c=jc[i%jc.length],jg=new THREE.Group();
const bell=new THREE.Mesh(new THREE.SphereGeometry(sz,12,8,0,6.28,0,Math.PI*.6),new THREE.MeshPhongMaterial({color:c,transparent:true,opacity:.35,side:2,shininess:40,emissive:new THREE.Color(c).multiplyScalar(.15)}));bell.name='bl';jg.add(bell);
jg.add(new THREE.Mesh(new THREE.SphereGeometry(sz*.55,8,6),new THREE.MeshPhongMaterial({color:c,transparent:true,opacity:.12,emissive:new THREE.Color(c).multiplyScalar(.3)})));
for(let t=0;t<8;t++){const tl=sz*1.5+Math.random()*sz*2;const tn=new THREE.Mesh(new THREE.CylinderGeometry(.015,.008,tl,3),new THREE.MeshPhongMaterial({color:c,transparent:true,opacity:.2}));const a=(t/8)*6.28;tn.position.set(Math.cos(a)*sz*.35,-tl/2-sz*.25,Math.sin(a)*sz*.35);tn.name='tn';jg.add(tn)}
jg.add(new THREE.PointLight(c,.25,6));
jg.position.set((Math.random()-.5)*WS*.7,4+Math.random()*20,(Math.random()-.5)*WS*.7);S.add(jg);
JE.push({m:jg,sz,ph:Math.random()*6.28,ps:.7+Math.random()*.6,v:new THREE.Vector3((Math.random()-.5)*.08,.03+Math.random()*.04,(Math.random()-.5)*.08)})}}

function mkWhale(){
const g=new THREE.Group();

// Blue-whale style gradient using layered body meshes
const bodyDeep = new THREE.MeshPhongMaterial({ color:0x2f516c, shininess:52, specular:0xa7d9ff });
const bodyMid  = new THREE.MeshPhongMaterial({ color:0x3f6b87, shininess:46, specular:0x9cc9ea });
const bodyLight= new THREE.MeshPhongMaterial({ color:0x7f9eb1, shininess:26, specular:0x7da4bb });
const bellyMat = new THREE.MeshPhongMaterial({ color:0xc7d6df, shininess:18 });

let geo;

// main torso
geo=new THREE.SphereGeometry(1,42,28); geo.scale(10.8,2.6,3.0);
const torso=new THREE.Mesh(geo,bodyDeep); g.add(torso);

// dorsal highlight strip for depth
geo=new THREE.SphereGeometry(1,30,20); geo.scale(10.5,1.25,2.25);
const dorsalStrip=new THREE.Mesh(geo,bodyMid); dorsalStrip.position.set(-0.2,1.0,0); g.add(dorsalStrip);

// belly line (ventral side)
geo=new THREE.SphereGeometry(1,28,18); geo.scale(8.2,1.2,2.1);
const belly=new THREE.Mesh(geo,bellyMat); belly.position.set(1.2,-1.2,0); g.add(belly);

// throat pleat effect (grooves)
for(let i=0;i<12;i++){
  const groove=new THREE.Mesh(new THREE.CylinderGeometry(0.05,0.05,6.9,6), new THREE.MeshPhongMaterial({color:0x9eb3bf,shininess:8}));
  groove.rotation.z=Math.PI/2;
  groove.position.set(4.8,-1.35,(i-5.5)*0.24);
  g.add(groove);
}

// head + rostrum
geo=new THREE.SphereGeometry(1,34,24); geo.scale(3.2,1.75,2.2);
const head=new THREE.Mesh(geo,bodyDeep); head.position.set(9.3,0.26,0); g.add(head);
geo=new THREE.SphereGeometry(1,26,16); geo.scale(2.15,0.95,1.55);
const rostrum=new THREE.Mesh(geo,bodyMid); rostrum.position.set(11.7,0.22,0); g.add(rostrum);

// jaw mass
geo=new THREE.SphereGeometry(1,24,14); geo.scale(2.7,0.95,1.65);
const jaw=new THREE.Mesh(geo,bodyLight); jaw.position.set(10.5,-0.85,0); g.add(jaw);

// blowholes
[-1,1].forEach(s=>{
  const bh=new THREE.Mesh(new THREE.SphereGeometry(0.12,8,8), new THREE.MeshPhongMaterial({color:0x163042,shininess:4}));
  bh.position.set(10.5,0.92,s*0.26); g.add(bh);
});

// eyes
[-1,1].forEach(s=>{
  const eye=new THREE.Mesh(new THREE.SphereGeometry(0.16,10,10), new THREE.MeshPhongMaterial({color:0x0f1116,shininess:90}));
  eye.position.set(10.8,0.08,s*1.52); g.add(eye);
});

// pectoral fins
[-1,1].forEach(s=>{
  const fin=new THREE.Mesh(new THREE.BoxGeometry(4.6,0.22,1.35), new THREE.MeshPhongMaterial({color:0x355971,shininess:20}));
  fin.position.set(3.7,-1.65,s*2.75);
  fin.rotation.x=s*0.12;
  fin.rotation.z=s*0.28;
  g.add(fin);
});

// tiny dorsal fin (blue whales have small dorsal fin far back)
const dorsal=new THREE.Mesh(new THREE.ConeGeometry(0.35,1.0,8), new THREE.MeshPhongMaterial({color:0x2a465a,flatShading:true}));
dorsal.position.set(-5.8,1.55,0); dorsal.rotation.z=0.08; g.add(dorsal);

// tail stock + fluke
geo=new THREE.SphereGeometry(1,24,18); geo.scale(4.4,1.05,1.45);
const tailStock=new THREE.Mesh(geo,bodyDeep); tailStock.position.set(-9.1,0,0); tailStock.name='wtc'; g.add(tailStock);

const flukeCenter=new THREE.Group(); flukeCenter.position.set(-13.7,0,0); flukeCenter.name='wt';
const flukeMat=new THREE.MeshPhongMaterial({color:0x29495f,shininess:24,specular:0x7ea5bd});
const leftFluke=new THREE.Mesh(new THREE.BoxGeometry(3.8,0.22,4.7),flukeMat);
leftFluke.position.set(0.9,0,2.25); leftFluke.rotation.y=0.18; leftFluke.rotation.x=0.05;
const rightFluke=leftFluke.clone(); rightFluke.position.z=-2.25; rightFluke.rotation.y=-0.18;
flukeCenter.add(leftFluke); flukeCenter.add(rightFluke); g.add(flukeCenter);

// mottled skin detail (adds WOW-factor texture without images)
for(let i=0;i<80;i++){
  const speck=new THREE.Mesh(new THREE.SphereGeometry(0.07+Math.random()*0.09,6,6), new THREE.MeshPhongMaterial({
    color: i%3===0 ? 0x86a5b8 : 0x2a4558,
    transparent:true,
    opacity: 0.55,
    shininess: 10
  }));
  speck.position.set(
    -7 + Math.random()*18,
    -0.9 + Math.random()*2.25,
    (Math.random()-0.5)*4.9
  );
  g.add(speck);
}

g.scale.set(1.55,1.55,1.55); // much bigger than manatee
g.position.set(78,22,-58);
S.add(g);
CR.push({m:g,type:'w',a:0,r:78,sp:.065,cy:22})}

function mkShark(){
const g=new THREE.Group();let geo=new THREE.SphereGeometry(1,10,8);geo.scale(2.5,.8,.7);g.add(new THREE.Mesh(geo,new THREE.MeshPhongMaterial({color:0x556677,shininess:20})));
geo=new THREE.SphereGeometry(1,8,6);geo.scale(1.8,.5,.55);const bl=new THREE.Mesh(geo,new THREE.MeshPhongMaterial({color:0xaabbcc}));bl.position.y=-.3;g.add(bl);
const df=new THREE.Mesh(new THREE.ConeGeometry(.3,1,4),new THREE.MeshPhongMaterial({color:0x445566,flatShading:true}));df.position.set(-.2,.8,0);df.rotation.z=.2;g.add(df);
const tl=new THREE.Mesh(new THREE.ConeGeometry(.5,.8,4),new THREE.MeshPhongMaterial({color:0x445566,flatShading:true}));tl.position.set(-2.8,.3,0);tl.rotation.z=1.2;tl.name='st';g.add(tl);
[-1,1].forEach(s=>{const e=new THREE.Mesh(new THREE.SphereGeometry(.06,5,5),new THREE.MeshPhongMaterial({color:0x111111}));e.position.set(1.8,.1,s*.55);g.add(e)});
g.scale.set(1.2,1.2,1.2);g.position.set(-30,12,50);S.add(g);
CR.push({m:g,type:'s',a:Math.PI,r:35,sp:.15,cy:10})}

function mkSmall(){
for(let i=0;i<45;i++){const g=new THREE.Group();const bd=new THREE.Mesh(new THREE.SphereGeometry(.1,6,5),new THREE.MeshPhongMaterial({color:0xee8866,flatShading:true}));bd.scale.set(1.5,.6,.6);g.add(bd);
[-.08,.08].forEach(z=>{const a=new THREE.Mesh(new THREE.CylinderGeometry(.005,.005,.3,3),new THREE.MeshPhongMaterial({color:0xdd7755}));a.position.set(.15,.05,z);a.rotation.z=-.8;g.add(a)});
g.position.set((Math.random()-.5)*WS*.8,-4+Math.random()*2,(Math.random()-.5)*WS*.8);g.scale.setScalar(1+Math.random());S.add(g);
CR.push({m:g,type:'sh',v:new THREE.Vector3((Math.random()-.5)*.02,0,(Math.random()-.5)*.02),ph:Math.random()*6.28})}
for(let i=0;i<24;i++){const g=new THREE.Group();const bd=new THREE.Mesh(new THREE.SphereGeometry(.15,6,5),new THREE.MeshPhongMaterial({color:0xaa3322,flatShading:true}));bd.scale.set(2,.7,.8);g.add(bd);
[-1,1].forEach(s=>{let geo=new THREE.SphereGeometry(.08,5,4);geo.scale(1.5,.5,.8);const cl=new THREE.Mesh(geo,new THREE.MeshPhongMaterial({color:0xcc4433,flatShading:true}));cl.position.set(.3,0,s*.2);cl.name='lc';g.add(cl)});
g.position.set((Math.random()-.5)*WS*.8,-5.2,(Math.random()-.5)*WS*.8);g.scale.setScalar(1.5+Math.random());S.add(g);
CR.push({m:g,type:'lb',v:new THREE.Vector3((Math.random()-.5)*.01,0,(Math.random()-.5)*.01),ph:Math.random()*6.28})}
for(let i=0;i<15;i++){const g=new THREE.Group();for(let a=0;a<5;a++){const arm=new THREE.Mesh(new THREE.CylinderGeometry(.02,.06,.3,4),new THREE.MeshPhongMaterial({color:[0xff6644,0xffaa33,0xdd55aa,0xffcc44,0xaa44dd][Math.floor(Math.random()*5)],flatShading:true}));const ang=(a/5)*6.28;arm.position.set(Math.cos(ang)*.12,0,Math.sin(ang)*.12);arm.rotation.z=Math.PI/2-Math.cos(ang)*.8;g.add(arm)}g.rotation.x=-Math.PI/2;g.position.set((Math.random()-.5)*WS*.8,-5.5,(Math.random()-.5)*WS*.8);g.scale.setScalar(1+Math.random()*2);S.add(g)}
for(let i=0;i<12;i++){const g=new THREE.Group();g.add(new THREE.Mesh(new THREE.SphereGeometry(.12,6,6),new THREE.MeshPhongMaterial({color:0x222233,flatShading:true})));for(let s=0;s<20;s++){const sp=new THREE.Mesh(new THREE.CylinderGeometry(.005,.005,.2+Math.random()*.15,3),new THREE.MeshPhongMaterial({color:0x1a1a2a}));const phi=Math.random()*6.28,theta=Math.random()*Math.PI;sp.position.set(Math.sin(theta)*Math.cos(phi)*.12,Math.cos(theta)*.12,Math.sin(theta)*Math.sin(phi)*.12);sp.lookAt(sp.position.clone().multiplyScalar(2));g.add(sp)}g.position.set((Math.random()-.5)*WS*.8,-5.3,(Math.random()-.5)*WS*.8);g.scale.setScalar(1+Math.random()*1.5);S.add(g)}}

function mkTurtle(){
for(let i=0;i<10;i++){const g=new THREE.Group();let geo=new THREE.SphereGeometry(.5,8,6);geo.scale(1,.5,1);g.add(new THREE.Mesh(geo,new THREE.MeshPhongMaterial({color:0x557744,flatShading:true})));
geo=new THREE.SphereGeometry(.45,8,5);geo.scale(.9,.2,.85);const bl=new THREE.Mesh(geo,new THREE.MeshPhongMaterial({color:0x88aa66,flatShading:true}));bl.position.y=-.15;g.add(bl);
const th=new THREE.Mesh(new THREE.SphereGeometry(.15,6,5),new THREE.MeshPhongMaterial({color:0x668855}));th.position.set(.55,0,0);g.add(th);
[[-1,1],[1,1],[-1,-1],[1,-1]].forEach(([sx,sz])=>{geo=new THREE.SphereGeometry(.12,5,4);geo.scale(1.5,.15,.8);const f=new THREE.Mesh(geo,new THREE.MeshPhongMaterial({color:0x668855,flatShading:true}));f.position.set(sx*.35,-.1,sz*.4);f.name='tf';g.add(f)});
[-.08,.08].forEach(z=>{const e=new THREE.Mesh(new THREE.SphereGeometry(.03,4,4),new THREE.MeshPhongMaterial({color:0x111111}));e.position.set(.65,.05,z);g.add(e)});
const px=(Math.random()-.5)*WS*.6,pz=(Math.random()-.5)*WS*.6,py=3+Math.random()*12;
g.position.set(px,py,pz);g.scale.setScalar(1.5+Math.random()*1.5);S.add(g);
CR.push({m:g,type:'tu',a:Math.random()*6.28,r:8+Math.random()*15,sp:.05+Math.random()*.05,cx:px,cz:pz,cy:py})}}

function mkShafts(){
for(let i=0;i<12;i++){const w=3+Math.random()*10;const sh=new THREE.Mesh(new THREE.PlaneGeometry(w,55),new THREE.MeshBasicMaterial({color:0x88ccaa,transparent:true,opacity:.015+Math.random()*.025,side:2,depthWrite:false}));sh.position.set((Math.random()-.5)*WS*.6,15,(Math.random()-.5)*WS*.6);sh.rotation.y=Math.random()*Math.PI;S.add(sh)}}

let WM;
function mkWater(){
const g=new THREE.PlaneGeometry(WS*3,WS*3,50,50);g.rotateX(-Math.PI/2);
WM=new THREE.Mesh(g,new THREE.MeshPhongMaterial({color:0x1a6b7a,transparent:true,opacity:.22,side:2,shininess:80,specular:0x88ccaa}));WM.position.y=28;S.add(WM)}

function mkParticles(){
const p=new Float32Array(800*3);for(let i=0;i<800;i++){p[i*3]=(Math.random()-.5)*WS;p[i*3+1]=Math.random()*32-4;p[i*3+2]=(Math.random()-.5)*WS}
const g=new THREE.BufferGeometry();g.setAttribute('position',new THREE.BufferAttribute(p,3));
S.add(new THREE.Points(g,new THREE.PointsMaterial({color:0xaaddcc,size:.06,transparent:true,opacity:.35,sizeAttenuation:true})))}

function mkSigns(){
eggs.forEach((e,i)=>{const g=new THREE.Group();
g.add(new THREE.Mesh(new THREE.CylinderGeometry(.04,.04,1.5,5),new THREE.MeshPhongMaterial({color:0x8a7a5a,flatShading:true})));
const cv=document.createElement('canvas');cv.width=512;cv.height=128;const cx=cv.getContext('2d');
cx.fillStyle='rgba(60,50,30,0.85)';cx.beginPath();
if (typeof cx.roundRect === 'function') {
  cx.roundRect(4,4,504,120,12);
} else {
  cx.rect(4,4,504,120);
}
cx.fill();
cx.fillStyle='#e8dcc0';cx.font='bold 26px Quicksand,sans-serif';cx.textAlign='center';cx.textBaseline='middle';
const w=e.t.split(' ');let ls=[],l='';w.forEach(x=>{if(cx.measureText(l+x+' ').width>460&&l){ls.push(l.trim());l=x+' '}else l+=x+' '});ls.push(l.trim());
const lh=30,sy=64-(ls.length-1)*lh/2;ls.forEach((x,j)=>cx.fillText(x,256,sy+j*lh));
const bd=new THREE.Mesh(new THREE.PlaneGeometry(2,.6),new THREE.MeshBasicMaterial({map:new THREE.CanvasTexture(cv),transparent:true,side:2}));bd.position.y=1;g.add(bd);
g.position.set(e.p[0],e.p[1]-3,e.p[2]);S.add(g);
SG.push({m:g,t:e.t,f:false,i:i})})}

function input(){
document.addEventListener('keydown',e=>{K[e.code]=true;if(e.code==='Space')e.preventDefault()});
document.addEventListener('keyup',e=>K[e.code]=false);
R.domElement.addEventListener('click',()=>{if(go)R.domElement.requestPointerLock()});
document.addEventListener('pointerlockchange',()=>lk=document.pointerLockElement===R.domElement);
document.addEventListener('mousemove',e=>{if(lk){cH-=e.movementX*.0025;cV=Math.max(-.7,Math.min(.85,cV-e.movementY*.0025))}});
document.addEventListener('wheel',e=>{cD=Math.max(4,Math.min(22,cD+e.deltaY*.01))});
const b=document.getElementById('jb'),th=document.getElementById('jt'),z=document.getElementById('jz');
if(z){z.addEventListener('touchstart',e=>{e.preventDefault();ja=true;jU(e.touches[0],b,th)},{passive:false});z.addEventListener('touchmove',e=>{e.preventDefault();if(ja)jU(e.touches[0],b,th)},{passive:false});z.addEventListener('touchend',()=>{ja=false;jdx=0;jdz=0;th.style.left='43px';th.style.top='43px'})}
const bu=document.getElementById('bu'),bd=document.getElementById('bd');
if(bu){bu.addEventListener('touchstart',e=>{e.preventDefault();mu=true},{passive:false});bu.addEventListener('touchend',()=>mu=false);bd.addEventListener('touchstart',e=>{e.preventDefault();md=true},{passive:false});bd.addEventListener('touchend',()=>md=false)}
document.addEventListener('touchstart',e=>{for(const t of e.touches)if(t.clientX>innerWidth*.35&&t.clientY<innerHeight*.7&&tlid===null){const el=document.elementFromPoint(t.clientX,t.clientY);if(!el||(!el.closest('#jz')&&!el.closest('#bu')&&!el.closest('#bd'))){tlid=t.identifier;tlx=t.clientX;tly=t.clientY}}});
document.addEventListener('touchmove',e=>{for(const t of e.changedTouches)if(t.identifier===tlid){cH-=(t.clientX-tlx)*.004;cV=Math.max(-.7,Math.min(.85,cV-(t.clientY-tly)*.004));tlx=t.clientX;tly=t.clientY}});
document.addEventListener('touchend',e=>{for(const t of e.changedTouches)if(t.identifier===tlid)tlid=null})}
function jU(t,b,th){const r=b.getBoundingClientRect();let dx=t.clientX-(r.left+r.width/2),dy=t.clientY-(r.top+r.height/2);const d=Math.sqrt(dx*dx+dy*dy);if(d>45){dx=dx/d*45;dy=dy/d*45}th.style.left=(43+dx)+'px';th.style.top=(43+dy)+'px';jdx=dx/45;jdz=dy/45}

function showMood(){const e=document.getElementById('mood');e.textContent=moods[Math.floor(Math.random()*moods.length)];e.classList.add('on');setTimeout(()=>e.classList.remove('on'),5000);setTimeout(showMood,10000+Math.random()*15000)}
function showDisc(t){const e=document.getElementById('disc');e.textContent='‚ú® '+t;e.classList.add('on');setTimeout(()=>e.classList.remove('on'),4000);fc++;document.getElementById('fnd').textContent='discovered: '+fc+'/14'}
function spB(x,y,z){const b=new THREE.Mesh(new THREE.SphereGeometry(.03+Math.random()*.05,5,5),new THREE.MeshPhongMaterial({color:0xaaddcc,transparent:true,opacity:.3,shininess:60}));b.position.set(x,y,z);S.add(b);BB.push({m:b,l:120+Math.random()*120,vy:.02+Math.random()*.03,vx:(Math.random()-.5)*.01,vz:(Math.random()-.5)*.01})}

function update(dt){
const t=CK.getElapsedTime();
const fw=new THREE.Vector3(-Math.sin(cH),0,-Math.cos(cH)),rt=new THREE.Vector3(-Math.cos(cH),0,Math.sin(cH));
let mx=0,mz=0,my=0;
if(K['KeyW']||K['ArrowUp']){mx+=fw.x;mz+=fw.z}
if(K['KeyS']||K['ArrowDown']){mx-=fw.x;mz-=fw.z}
if(K['KeyA']||K['ArrowLeft']){mx+=rt.x;mz+=rt.z}
if(K['KeyD']||K['ArrowRight']){mx-=rt.x;mz-=rt.z}
if(K['Space']||mu)my=1;if(K['ShiftLeft']||K['ShiftRight']||md)my=-1;
if(ja){mx+=fw.x*-jdz+rt.x*jdx;mz+=fw.z*-jdz+rt.z*jdx}
const sp=7*dt;M.position.x+=mx*sp;M.position.z+=mz*sp;
M.position.y=Math.max(-3,Math.min(26,M.position.y+my*sp*.6))+Math.sin(t*.7)*.004;
// Face away from camera
const tr=cH+Math.PI;let df=tr-M.rotation.y;while(df>Math.PI)df-=6.28;while(df<-Math.PI)df+=6.28;
M.rotation.y+=df*4*dt;M.rotation.z+=(-my*.15-M.rotation.z)*2*dt;
// Parts
const tail=M.getObjectByName('tail');if(tail)tail.rotation.y=Math.sin(t*2.2)*.28;
const tc=M.getObjectByName('tc');if(tc)tc.rotation.y=Math.sin(t*2.2+.5)*.12;
const fl=M.getObjectByName('fl'),fr=M.getObjectByName('fr');
if(fl)fl.rotation.z=-.4+Math.sin(t*1.6)*.15;if(fr)fr.rotation.z=.4-Math.sin(t*1.6+1)*.15;
if(Math.random()<.035){const np=new THREE.Vector3(2.2,.1,0).applyQuaternion(M.quaternion).add(M.position);spB(np.x,np.y,np.z)}
// Over-shoulder third-person camera
const followDist = Math.max(7, Math.min(14, cD));
const camOffset = new THREE.Vector3(
  Math.sin(cH) * Math.cos(cV) * followDist,
  2.8 + Math.sin(cV) * 2.2,
  Math.cos(cH) * Math.cos(cV) * followDist
);
const camPos = M.position.clone().add(camOffset);
const lookTarget = M.position.clone().add(new THREE.Vector3(0, 0.75, 0));
C.position.lerp(camPos, 5 * dt);
C.lookAt(lookTarget);
document.getElementById('dep').textContent='depth: '+Math.max(0,Math.round(26-M.position.y))+'m';
// Grass
GR.forEach(g=>{if(g.kp){g.m.children.forEach((c,i)=>{if(c.name==='ks'){c.rotation.x=Math.sin(t*g.sp+g.ph+i*.3)*.1;c.rotation.z=Math.sin(t*g.sp*.7+g.ph+i*.2)*.08}})}else g.m.rotation.z=g.bz+Math.sin(t*g.sp+g.ph)*.15});
// Fish
FI.forEach(sc=>sc.forEach(f=>{f.v.add(f.ct.clone().sub(f.m.position).multiplyScalar(.002));const tm=f.m.position.clone().sub(M.position);const md2=tm.length();if(md2<10)f.v.add(tm.normalize().multiplyScalar(.08*(1-md2/10)));f.v.x+=(Math.random()-.5)*.004;f.v.z+=(Math.random()-.5)*.004;f.v.y+=(Math.random()-.5)*.002;f.v.multiplyScalar(.99).clampLength(0,.35);f.m.position.add(f.v);if(f.v.length()>.01)f.m.rotation.y=Math.atan2(f.v.x,f.v.z);const ft=f.m.getObjectByName('ft');if(ft)ft.rotation.y=Math.sin(t*7+f.ph)*.35}));
// Jelly react
JE.forEach(j=>{const tm=j.m.position.clone().sub(M.position);const md2=tm.length();if(md2<6){j.v.add(tm.normalize().multiplyScalar(.03*(1-md2/6)));j.ps=Math.min(2,j.ps+dt*2)}else j.ps+=(.7-j.ps)*.01;j.m.position.add(j.v.clone().multiplyScalar(dt*30));j.v.multiplyScalar(.98);j.m.position.y+=Math.sin(t*.5+j.ph)*.008;const bl=j.m.getObjectByName('bl');const p=Math.sin(t*j.ps+j.ph);if(bl){bl.scale.x=1+p*.18;bl.scale.z=1+p*.18;bl.scale.y=1-p*.12}j.m.children.forEach(c=>{if(c.name==='tn'){c.rotation.x=Math.sin(t*1.3+j.ph)*.18;c.rotation.z=Math.sin(t*.9+j.ph+1)*.12}});if(j.m.position.y>28)j.v.y-=.01;if(j.m.position.y<-2)j.v.y+=.01;if(Math.abs(j.m.position.x)>100)j.v.x*=-1;if(Math.abs(j.m.position.z)>100)j.v.z*=-1});
// Creatures
CR.forEach(c=>{
if(c.type==='w'){
  c.a+=c.sp*dt;
  c.m.position.set(Math.cos(c.a)*c.r,c.cy+Math.sin(t*.22)*2.8,Math.sin(c.a)*c.r);
  c.m.rotation.y=c.a+Math.PI/2;
  const w=c.m.getObjectByName('wt');
  const ws=c.m.getObjectByName('wtc');
  if(w) w.rotation.y=Math.sin(t*1.2)*0.3;
  if(ws) ws.rotation.y=Math.sin(t*1.2+0.6)*0.12;
  if(M.position.distanceTo(c.m.position)<26&&!disc.has('whale')){
    disc.add('whale');
    showDisc('üêã BLUE WHALE SIGHTING ‚Äî absolute unit detected.');
  }
}
if(c.type==='s'){c.a+=c.sp*dt;c.m.position.set(Math.cos(c.a)*c.r+10,c.cy+Math.sin(t*.5)*1.5,Math.sin(c.a)*c.r-10);c.m.rotation.y=c.a+Math.PI/2;const s=c.m.getObjectByName('st');if(s)s.rotation.y=Math.sin(t*3)*.15;if(M.position.distanceTo(c.m.position)<12&&!disc.has('shark')){disc.add('shark');showDisc('ü¶à The shark is more scared of you tbh')}}
if(c.type==='tu'){c.a+=c.sp*dt;c.m.position.set(c.cx+Math.cos(c.a)*c.r,c.cy+Math.sin(t*.4+c.a)*.5,c.cz+Math.sin(c.a)*c.r);c.m.rotation.y=c.a+Math.PI/2;c.m.children.forEach(ch=>{if(ch.name==='tf')ch.rotation.z=Math.sin(t*2+c.a)*.2})}
if(c.type==='sh'||c.type==='lb'){c.m.position.add(c.v);if(Math.random()<.01)c.v.set((Math.random()-.5)*.03,0,(Math.random()-.5)*.03);const d=c.m.position.distanceTo(M.position);if(d<5)c.v.add(c.m.position.clone().sub(M.position).normalize().multiplyScalar(.04));c.v.multiplyScalar(.96);if(c.v.length()>.005)c.m.rotation.y=Math.atan2(c.v.x,c.v.z);if(c.type==='lb')c.m.children.forEach(ch=>{if(ch.name==='lc')ch.rotation.z=Math.sin(t*2+c.ph)*.3})}});
// Signs
SG.forEach(s=>{s.m.children[1].lookAt(C.position);const d=s.m.position.distanceTo(M.position);if(d<8&&!s.f){s.f=true;disc.add('s'+s.i);showDisc(s.t)}});
// Water
if(WM){const wp=WM.geometry.attributes.position;for(let i=0;i<wp.count;i++)wp.setY(i,Math.sin(wp.getX(i)*.04+t*.4)*.6+Math.cos(wp.getZ(i)*.06+t*.3)*.5);wp.needsUpdate=true}
// Bubbles
for(let i=BB.length-1;i>=0;i--){const b=BB[i];b.m.position.y+=b.vy;b.m.position.x+=b.vx+Math.sin(t*3+i)*.002;b.m.position.z+=b.vz;b.l--;b.m.material.opacity*=.997;if(b.l<=0){S.remove(b.m);b.m.geometry.dispose();b.m.material.dispose();BB.splice(i,1)}}
}

function loop(){requestAnimationFrame(loop);if(!go)return;update(Math.min(CK.getDelta(),.05));R.render(S,C)}
document.getElementById('title-screen').addEventListener('click',()=>{if(go)return;go=true;document.getElementById('title-screen').classList.add('hidden')});
window.addEventListener('resize',()=>{C.aspect=innerWidth/innerHeight;C.updateProjectionMatrix();R.setSize(innerWidth,innerHeight)});
init();loop();
</script>
</body>
</html>
